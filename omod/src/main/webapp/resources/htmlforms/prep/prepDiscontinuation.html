<!--
  ~ The contents of this file are subject to the OpenMRS Public License
  ~ Version 1.0 (the "License"); you may not use this file except in
  ~ compliance with the License. You may obtain a copy of the License at
  ~ http://license.openmrs.org
  ~
  ~ Software distributed under the License is distributed on an "AS IS"
  ~ basis, WITHOUT WARRANTY OF ANY KIND, either express or implied. See the
  ~ License for the specific language governing rights and limitations
  ~ under the License.
  ~
  ~ Copyright (C) OpenMRS, LLC.  All Rights Reserved.
-->
<htmlform>
	<style>
		.simple-table {
			border: solid 1px #DDEEEE;
			border-collapse: collapse;
			border-spacing: 0;
			font: normal 13px Arial, sans-serif;
		}
		.simple-table thead th {
			background-color: #DDEFEF;
			border: solid 1px #DDEEEE;
			color: #336B6B;
			padding: 10px;
			text-align: left;
			text-shadow: 1px 1px 1px #fff;
		}
		.simple-table td {
			border: solid 1px #DDEEEE;
			color: #333;
			padding: 10px;
			text-shadow: 1px 1px 1px #fff;
		}

	</style>

	<script type="text/javascript">
		var value1;
		jq(document).ready(function(){
			jq('#other-reason').hide();
			jq('#discontinue').click(showOptionsOther);

			if ((getValue('idReason.value')) == 160034) {
				jq('#pdied :input').prop('disabled', false);
				jq('#ptransferred :input').prop('disabled', true);
			}
			else if((getValue('idReason.value')) == 159492) {
				jq('#pdied :input').prop('disabled', true);
				jq('#ptransferred :input').prop('disabled', false);
			}
			else {
				jq('#pdied :input').prop('disabled', true);
				jq('#ptransferred :input').prop('disabled', true);
			}

			jq("#idReason select").change(function() {
				if ((getValue('idReason.value')) == 160034) {
					jq('#pdied :input').prop('disabled', false);
					jq('#ptransferred :input').prop('disabled', true);
				}
				else if((getValue('idReason.value')) == 159492) {
					jq('#pdied :input').prop('disabled', true);
					jq('#ptransferred :input').prop('disabled', false);
				}
				else {
					jq('#pdied :input').prop('disabled', true);
					jq('#ptransferred :input').prop('disabled', true);
				}
			});

			var pbirthdate = new Date("<lookup expression="patient.birthdate" />").getTime();
			var discontinueDate;

			beforeSubmit.push(function() {
				discontinueDate = new Date(getValue('encounter-date.value')).getTime();

				if(discontinueDate &lt; pbirthdate){
					getField('discontinueDate.error').html('Discontinue date, should not be earlier than Birth date').show();
					return false;
				}
				// alert(pbirthdate+" and "+discontinueDate);
				return true;
			});
		});

		function showOptionsOther() {
			var other = jq('#discontinue option:selected').val();
			if(other ==5622) {
				jq('#other-reason').show();
			}else {
				jq('#other-reason').hide();
			}

		}
	</script>
	<div class="ke-form-header">
		<table width="100%">
			<tr>
				<td>Date: <encounterDate id="encounter-date" showTime="true" /></td>
				<td>Location: <encounterLocation default="GlobalProperty:kenyaemr.defaultLocation" type="autocomplete" /></td>
			</tr>
		</table>
	</div>

	<div class="ke-form-content">
		<fieldset>
			<legend>Discontinue PrEP Care</legend>
			<div style="color: lightsalmon"><b>Please counsel client on safe prep discontinuation and give drugs for 28 days</b></div>
			<table class="simple-table">
				<tr id="discontinue-status">
					<td>Discontinue reasons</td>
					<td><obs id="discontinue" conceptId="161555" labelText=" "   answerConceptIds="138571AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA,
						113338AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA,1302AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA,
						159598AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA,164401AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA,
						162696AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA,150506AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA,
						978AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA,160581AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA,5622"
							 answerLabels="HIV test is positive,Renal dysfunction,Viral suppression of HIV+,
							 Not adherent to PrEP,Too many HIV tests,Client request,Intimate partner violence,
							 Self Discontinuation,Low risk of HIV,Other-specify"  style="dropdown"/>
						<obs id="other-reason" conceptId="160632AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA" />
					</td>

				</tr>
				<tr>
					<td id="care-end-date-label">Date Prep Discontinued:</td>
					<td id="care-end-date"><obs conceptId="5096AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA" /></td>
				</tr>

				<tr>
					<td id="date-last-dose-label">Date of Last Prep dose:</td>
					<td id="date-last-dose"><obs conceptId="162549AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA" allowFutureDates="true" /></td>
				</tr>

			</table>
		</fieldset>

		<completeProgram programId="214cad1c-bb62-4d8e-b927-810a046daf62" />
	</div>

	<div class="ke-form-footer">
		<submit />
	</div>

</htmlform>